#!/usr/bin/env python

"""
Logfind: implementation of http://projectsthehardway.com/2015/06/16/project-1-logfind-2/
"""
import os
import sys
import lf.utils as lf
import argparse

def main():

    parser = argparse.ArgumentParser(description='Find string(s) in logfiles. Logfiles to search are specified in ~/.logfind.')
    parser.add_argument('strings', metavar='string', type=str, nargs='+',
                           help='string to find in the log files')
    parser.add_argument('-o', action='store_true', help='use OR semantics (default: use AND)')
    #parser.add_argument('-e', dest='store_true', help='strings are perl regular expressions')
    args = parser.parse_args()

    print args.strings

    conffile = os.environ['HOME'] + '/.logfind'
    files = lf.conf_to_files(conffile)

    if args.o:
        matched_logs = lf.search(files, sys.argv, 'or')
        for log in matched_logs:
            print log
    else:
        matched_logs = lf.search(files, sys.argv, 'and')
        for log in matched_logs:
            print log

def usage():
    print "logfind: find strings in logfiles\n"
    print "usage:",sys.argv[0],"[-o] string ...\n\n\t -o use OR semantics\n"

# run main if invoked as a script
if __name__ == "__main__":
    main()

# vim: tabstop=8 expandtab shiftwidth=4 softtabstop=4
